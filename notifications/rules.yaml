---
groups:
  - name: Sausage store rules
    rules:
    - alert: InstanceIsDown
      expr: up{app="backend"} == 0
      for: 1m
      labels:
        severity: critical
        project: "sausage_store"
        component: "Backend"
      annotations:
        description: '{{ $labels.instance }}  check pod'
        summary: 'student std-014-65  pod {{ $labels.kubernetes_pod_name}} down'
    - alert: POST requests
      expr: histogram_quantile(0.95, sum by(le) (rate(http_server_requests_seconds_bucket{method="POST", uri="/api/orders"}[5m]))) >= 0.1
      labels:
        severity: warning
        project: "sausage_store"
        component: "backend"
      annotations:
        description: 'значением задержки более 100ms для 95 перцентиля в течение 5 минут'
        summary: 'student std-014-65 {{ $labels.project }}{{ $labels.component }} slower'
    - alert: Status 500
      expr: rate (http_server_requests_seconds_count{status="500"}[10m]) > 0
      labels:
        severity: critical
        project: "sausage_store"
      annotations:
        description: '{{ $labels.uri }} Status 500'
        summary: 'student std-014-65 Alarm {{ $labels.uri }} Status 500'
    - alert: Actuator error
      expr: rate (http_server_requests_seconds_count{status=~"5..|4..",uri="/actuator/prometheus"}[2m]) > 0
      labels:
        severity: warning
        project: "sausage_store"
        component: "prometheus"
      annotations:
        description: '{{ $labels.uri }} проверка {{ $labels.status }}'
        summary: 'student std-014-65 {{ $labels.uri }} нуждается в проверке'
